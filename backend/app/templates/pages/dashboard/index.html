{% extends "base.html" %}

{% block title %}Dashboard - Verdoylab{% endblock %}

{% block content %}
<main class="dashboard">
    <!-- Page Header -->
    
    <!-- Summary Statistics -->
    <section class="stats-section">
        <div class="container">
            <div class="stats-grid" 
                 hx-get="/app/dashboard/stats" 
                 hx-trigger="every 30s"
                 hx-swap="innerHTML">
                {% with stats = dashboard.summary_stats %}
                    {% include "partials/dashboard_stats.html" %}
                {% endwith %}
            </div>
        </div>
    </section>

    <!-- Organizations Grid -->
    <section class="organizations-section">
        <div class="container">
            <div class="section-header">
                <h2>Your Organizations</h2>
                <a href="/app/admin/organization/" class="btn btn-secondary">View All</a>
            </div>
            
            {% if dashboard.organizations %}
            <div class="organizations-grid">
                {% for org in dashboard.organizations %}
                <article class="org-card">
                    <div class="org-header">
                        <h3>{{ org.name }}</h3>
                        <span class="org-status {% if org.online_bioreactors > 0 %}online{% else %}offline{% endif %}">
                            {{ org.online_bioreactors }} online
                        </span>
                    </div>
                    
                    <p class="org-description">{{ org.description }}</p>
                    
                    <div class="org-stats">
                        <div class="stat">
                            <span class="stat-value">{{ org.active_experiments }}</span>
                            <span class="stat-label">Active Experiments</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">{{ org.member_count }}</span>
                            <span class="stat-label">Members</span>
                        </div>
                        <div class="stat">
                            <span class="stat-value">{{ org.online_bioreactors }}</span>
                            <span class="stat-label">Online Bioreactors</span>
                        </div>
                    </div>
                    
                    <div class="org-actions">
                        <a href="/app/admin/organization/{{ org.id }}" class="btn btn-primary">View Details</a>
                        <span class="btn btn-secondary btn-disabled" title="Coming soon">Experiments</span>
                    </div>
                    
                    {% if org.recent_activity %}
                    <div class="org-activity">
                        <h4>Recent Activity</h4>
                        <ul class="activity-list">
                            {% for activity in org.recent_activity[:3] %}
                            <li class="activity-item activity-{{ activity.type }}">
                                <span class="activity-message">{{ activity.message }}</span>
                                <span class="activity-time">{{ activity.time }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                    {% endif %}
                </article>
                {% endfor %}
            </div>
            {% else %}
            <!-- Empty State for No Organizations -->
            <div class="empty-state">
                <div class="empty-icon">üè¢</div>
                <h3>No Organizations Found</h3>
                <p>You don't have access to any organizations yet. Contact your administrator or create a new organization to get started.</p>
                <div class="empty-actions">
                    <a href="/app/admin/organization/create" class="btn btn-primary">Create Organization</a>
                    <a href="/app/admin/organization/" class="btn btn-secondary">View All Organizations</a>
                </div>
            </div>
            {% endif %}
        </div>
    </section>

    <!-- Recent Activity Feed -->
    <section class="activity-section">
        <div class="container">
            <div class="section-header">
                <h2>Recent Activity</h2>
                <button class="btn btn-secondary" 
                        hx-get="/app/dashboard/activity" 
                        hx-target="#activity-feed"
                        hx-swap="innerHTML">
                    Refresh
                </button>
            </div>
            
            <div id="activity-feed" 
                 hx-get="/app/dashboard/activity" 
                 hx-trigger="every 60s"
                 hx-swap="innerHTML">
                {% include "partials/activity_feed.html" %}
            </div>
        </div>
    </section>

    <!-- Quick Actions -->
    <section class="quick-actions">
        <div class="container">
            <h2>Quick Actions</h2>
            <div class="actions-grid">
                <a href="/app/admin/organization/" class="action-card">
                    <div class="action-icon">üè¢</div>
                    <span class="action-text"><h3>Manage organizations</h3></span>
                </a>
                
                <a href="/app/projects/create" class="action-card">
                    <div class="action-icon">üìã</div>
                    <span class="action-text"><h3>Create a project</h3></span>
                </a>
                
                <a href="/app/bioreactors/enroll" class="action-card">
                    <div class="action-icon">üî¨</div>
                    <span class="action-text"><h3>Enroll a tool</h3></span>
                </a>
                
                <span class="action-card action-disabled" title="Coming soon">
                    <div class="action-icon">üß™</div>
                    <span class="action-text"><h3>Create an experiment</h3></span>
                </span>
                
                <a href="/app/processes/create" class="action-card">
                    <div class="action-icon">‚öôÔ∏è</div>
                    <span class="action-text"><h3>Add a new process</h3></span>
                </a>
                
                <span class="action-card action-disabled" title="Coming soon">
                    <div class="action-icon">üìä</div>
                    <span class="action-text"><h3>Manage analytics</h3></span>
                </span>
                
                <span class="action-card action-disabled" title="Coming soon">
                    <div class="action-icon">üîî</div>
                    <span class="action-text"><h3>Review alerts</h3></span>
                </span>
            </div>
        </div>
    </section>
</main>
{% endblock %} 